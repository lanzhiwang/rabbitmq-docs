## TLS Support

PerfTest can use TLS to connect to a node that is [configured to accept TLS connections](https://www.rabbitmq.com/ssl.html). To enable TLS, simply specify a URI that uses the `amqps` schema:  PerfTest 可以使用 TLS 连接到配置为接受 TLS 连接的节点。 要启用 TLS，只需指定一个使用 amqps 架构的 URI：

```bash
bin/runjava com.rabbitmq.perf.PerfTest -h amqps://localhost:5671
```

By default PerfTest automatically trusts the server and doesn’t present any client certificate (a warning shows up in the console). In many benchmarking or load testing scenarios this may be sufficient. If peer verification is necessary, it is possible to use the [appropriate JVM properties](https://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/JSSERefGuide.html#InstallationAndCustomization) on the command line to override the default `SSLContext`. For example, to trust a given server:  默认情况下，PerfTest 会自动信任服务器并且不提供任何客户端证书（控制台中会显示警告）。 在许多基准测试或负载测试场景中，这可能就足够了。 如果需要对等验证，则可以在命令行上使用适当的 JVM 属性来覆盖默认 SSLContext。 例如，要信任给定的服务器：

```bash
JAVA_OPTS="
-Djavax.net.ssl.trustStore=/path/to/server_key.p12
-Djavax.net.ssl.trustStorePassword=bunnies
-Djavax.net.ssl.trustStoreType=PKCS12"
bin/runjava com.rabbitmq.perf.PerfTest -h amqps://localhost:5671
```

The previous snippet uses a one-liner to define the `JAVA_OPTS` environment variable while running PerfTest. Please refer to the [TLS guide](https://www.rabbitmq.com/ssl.html) to learn about how to set up RabbitMQ with TLS. A convenient way to generate a CA and some self-signed certificate/key pairs for development and QA environments is with [`tls-gen`](https://github.com/michaelklishin/tls-gen/). tls-gen’s basic profile is a good starting point. How to run PerfTest with a certificate/key pair generated by the aforementioned profile: 前面的代码片段使用单行代码在运行 PerfTest 时定义 JAVA_OPTS 环境变量。 请参阅 TLS 指南以了解如何使用 TLS 设置 RabbitMQ。 为开发和 QA 环境生成 CA 和一些自签名证书/密钥对的一种便捷方法是使用 tls-gen。 tls-gen 的基本配置文件是一个很好的起点。 如何使用由上述配置文件生成的证书/密钥对运行 PerfTest：

```bash
JAVA_OPTS="
-Djavax.net.ssl.trustStore=/path/to/server_key.p12
-Djavax.net.ssl.trustStorePassword=bunnies
-Djavax.net.ssl.trustStoreType=PKCS12
-Djavax.net.ssl.keyStore=/path/to/client_key.p12
-Djavax.net.ssl.keyStorePassword=bunnies
-Djavax.net.ssl.keyStoreType=PKCS12"
bin/runjava com.rabbitmq.perf.PerfTest -h amqps://localhost:5671
```













```bash

5671:31450/TCP,15671:31426/TCP,15691:32117/TCP,5672:31755/TCP,15672:30206/TCP
10.0.128.95


./runjava com.rabbitmq.perf.PerfTest -h amqp://E-OBxlPASXhvUSP4ZOFnwZvr40vcOQNJ:quF8_CLJSuB46Wnnm7lJTi54cXRzOfLp@10.0.128.95:31755 -x 1 -y 1 -u "throughput-test-1" -a --id "test 1" -s 4 -z 30



JAVA_OPTS="-Djavax.net.ssl.trustStore=/root/temp/tls-gen/basic/result/server_key.p12 -Djavax.net.ssl.trustStoreType=PKCS12 -Djavax.net.ssl.keyStore=/root/temp/tls-gen/basic/result/client_key.p12 -Djavax.net.ssl.keyStoreType=PKCS12" ./runjava com.rabbitmq.perf.PerfTest -h amqps://E-OBxlPASXhvUSP4ZOFnwZvr40vcOQNJ:quF8_CLJSuB46Wnnm7lJTi54cXRzOfLp@10.0.128.95:31450 -x 1 -y 1 -u "throughput-test-1" -a --id "test 1" -s 4 -z 30

https://medium.com/@gustavocalcaterra/debugging-yet-another-ssl-tls-error-the-trustanchors-parameter-must-be-non-empty-7dd9cb300f43



JAVA_OPTS="-Djavax.net.ssl.trustStore=/root/temp/tls-gen/basic/result/server_key.p12 -Djavax.net.ssl.trustStoreType=PKCS12" ./runjava com.rabbitmq.perf.PerfTest -h amqps://E-OBxlPASXhvUSP4ZOFnwZvr40vcOQNJ:quF8_CLJSuB46Wnnm7lJTi54cXRzOfLp@10.0.128.95:31450 -x 1 -y 1 -u "throughput-test-1" -a --id "test 1" -s 4 -z 30




keytool -keystore /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.302.b08-0.el7_9.x86_64/jre/lib/security/cacerts --list
changeit

keytool -keystore /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.302.b08-0.el7_9.x86_64/jre/lib/security/cacerts -alias kafka-zookeeper-ca-cert -import -file /root/temp/tls-gen/basic/result/ca_certificate.pem

keytool -delete -alias kafka-zookeeper-ca-cert -keystore /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.302.b08-0.el7_9.x86_64/jre/lib/security/cacerts


openssl req -new -x509 -keyout ca-key -out ca-cert -days 3650

keytool -keystore kafka.zookeeper.truststore.jks -alias ca-cert -import -file ca-cert

keytool -keystore kafka.zookeeper.keystore.jks -alias zookeeper -validity 3650 -genkey -keyalg RSA -ext SAN=dns:localhost

keytool -keystore kafka.zookeeper.keystore.jks -alias zookeeper -certreq -file ca-request-zookeeper

openssl x509 -req -CA ca-cert -CAkey ca-key -in ca-request-zookeeper -out ca-signed-zookeeper -days 3650 -CAcreateserial

keytool -keystore kafka.zookeeper.keystore.jks -alias ca-cert -import -file ca-cert

keytool -keystore kafka.zookeeper.keystore.jks -alias zookeeper -import -file ca-signed-zookeeper



```

